# 微服务面试题

## 微服务有哪些优缺点

- 优点

    1. 每个服务足够内聚，足够小，代码容易理解，这样能聚焦一个指定的业务功能或业务需求。
    2. 开发简单、开发效率提高、一个服务可能就是专一的只干一件事。
    3. 微服务能够被小团队单独开发，这个团队是2到5人的开发人员组成。
    4. 微服务是松耦合的，是有功能意义的服务，无论是在开发阶段或部署阶段都是独立的。
    5. 微服务能够使用不同的语言开发。
    6. 易于和第三方集成，微服务允许容易且灵活的方式集成自动部署，通过持续集成工具，如Jenkins、Hudson、bamboo。
    7. 微服务易于被一个开发人员理解，修改和维护。这样小团队能够更加关注自己的工作成果，无需通过合作才能体现价值。
    8. 微服务允许你利用融合最新技术。
    9. 微服务只是业务逻辑的代码，不会和HTML、CSS或其他页面组件混合。
    10. 每个微服务都有自己的存储能力，可以有自己的数据库，也可以有统一数据库。

- 缺点
    
    1. 开发人员要处理分布式系统的复杂性。
    2. 多服务运维难度，随着服务的增多，运维的压力也在增大。
    3. 系统部署依赖。
    4. 服务间通信成本。
    5. 数据一致性。
    6. 系统集成测试。
    7. 性能监控。
    
## 微服务技术栈有哪些

技术栈：多种技术的集合体。

- 维度
    - 服务开发：SpringBoot、Spring、SpringMVC
    - 服务配置与管理：Netflix公司的Archaius、阿里的Diamond等
    - 服务注册与发现：Eureka、Consul、Zookeeper等
    - 服务调用：Rest、RPC、gRPC
    - 服务熔断器：Hystrix、Envoy等
    - 负载均衡：Riboon、Nginx等
    - 服务接口调用（客户端调用服务的简化工具）：Feign等
    - 消息队列：Kafka、RabbitMQ、ActiveMQ等
    - 服务配置中心管理：Spring Cloud Config、Chef等
    - 服务网关（API网关）：Zuul等
    - 服务监控：Zabbix、Nagios、Metrices、Spectator等
    - 全链路跟踪：Zipkin、Brave、Dapper等
    - 服务部署：Docker、OpenStack、Kubernetes等
    - 数据流操作开发包：Spring Cloud Stream（封装与Redis、RabbitMQ、Kafka等发送接收消息）
    - 事件消息总线：Spring Cloud Bus
    
### 微服务种类
    
- dubbo + zookeeper
    1. 服务治理：dubbo
    2. 服务注册：zookeeper
    3. 服务调用：dubbo
    4. 服务负载均衡：nginx
    5. 服务监控：dubbo-admin + dubbo-monitor
    
- SpringCloud
    1. 服务治理：Spring Cloud
    2. 服务注册：Eureka
    3. 服务调用：Feign
    4. 服务负载均衡：Ribbon
    5. 服务监控：SpringCloud Admin
    
## 为什么选择SpringCloud作为微服务架构

- 选型依据
    - 整体解决方案和框架成熟度
    - 社区热度
    - 可维护性
    - 学习曲线
    
- 当前各大IT公司用的微服务架构有哪些？
    - 阿里：Dubbo/HSF
    - 京东：JSF
    - 新浪微博：Motan
    - 当当网：DubboxX
    
## SpringCloud是什么？

SpringCloud，基于SpringBoot提供了一套微服务解决方案，包括服务注册与发现，配置中心，全链路监控，服务网关，负载均衡，熔断器等组件，除了基于NetFlix的开源组件做高度抽象封装之外，还有一些选型中立的开源组件。

SpringCloud利用SpringBoot的开发便利性巧妙地简化了分布式系统基础设施的开发，SpringCloud为开发人员提供了快速构建分布式系统的一些工具，包括配置管理、服务发现、断路器、路由、微代理、事件总线、全局锁、决策竞选、分布式会话等等，它们都可以用SpringBoot开发风格做到一键启动和部署。

SpringBoot并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来,通过SpringBoot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单 易懂、易部署和易维护的分布式系统开发工具包。

## SpringCloud和SpringBoot有什么关系

- SpringBoot
    1. SpringBoot专注于快速方便的开发单个个体微服务。
    2. SpringBoot寺注于快速、方便的幵友単个微服努个体，SpringCloud关注全局的服务治理框架。

- SpringCloud
    1. SpringCloud是关注全局的微服务协调整理治理框架，它将SpringBoot开发的一个个单体微服务整合并管理起来，为各个微服务之问提供，配置管理、服务发现、断路器、路由、微代理、事性总线、全局锁、决策竞选、分布式会话等等集成服务。
    2. SpringCloud依赖于SpringBoot。SpringCloud是微服务架构下的一站式解决方案，是各个微服务架构落地技术的集合体。
    3. SpringBoot可以离开SpringCloud独立使用开发项目， 但是SpringCloud离不开SpringBoot. 属于依赖的关系。
    
## SpringCloud和Dubbo对比

- SpringCloud和Dubbo之间的关系，业务上是否有冲突

    1. Dubbo的定位始终是一款RPC框架，而SpringCloud的目标是微服务架构下的一站式解决方案。
    2. 在面临微服务基础框架选型时，Dubbo与SpringCloud是只能二选一。
    3. Dubbo之后会积极寻求适配到SpringCloud生态，比如作为SpringCloud的二进制通信方案来发挥Dubbo的性能优势，或者Dubbo通过模块化以及对http的支持适配到SpringCloud。

## Eureka服务注册与发现

- Eureka是什么
    1. Eureka在微服务架构中重要的一员，负责服务注册与发现，只需要使用服务的标识符，就可以访问到服务，而不需要修改服务调用的配置文件，功能类似Dubbo的注册中心，比如Zookeeper。
    2. Netflix在设计Eureka时遵守的就是AP原则。（一句话概括：某时刻某一个微服务不可用了，eureka不会立刻清理，依旧会对该服务的信息进行保存）
    
- Eureka架构
    1. Eureka包含两个组件：Eureka Server和Eureka Client
    2. 各个节点启动后，会在EurekaServer中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观的看到
    3. EurekaClient是一个Java客户端，用于简化Eureka Server的交互，客户端同时也具备一个内置的，使用轮询(round-robin)负载算法的负载均衡器。在应用启动后，将会向Eureka Server发送心跳(默认周期为30秒)。如果Eureka Server在多个心跳周期内没有接收到某个节点的心跳，EurekaServer将会从服务注册表中把这个服务节点移除(默认90秒)I

## 什么是Eureka的自我保护机制

默认情况下，如果EurekaServer在- 定时间内没有接收到某个微服务实例的心跳，EurekaServer将会注销该实例(默认90秒)。
但是当网络分区故障发生时,微服务与EurekaServer之间无法正常通信，以上行为可能变得非常危险了一 因为微服务本身其实
是健康的，此时本不应该注销这个微服务。Eureka通过“自我保护模式”来解决这个问题一 当EurekaServer节点在短时间内丢
失过多客户端时(可能发生了网络分区故障)， 那么这个节点就会进入自我保护模式。一-旦进入该模式，EurekaServer就会保护服
务注册表中的信息，不再删除服务注册表中的数据(也就是不会注销任何微服务)。当网络故障恢复后，该Eureka Server节点会
自动退出自我保护模式。

在自我保护模式中，Eureka Server会保护服务注册表中的信息，不再注销任何服务实例。当它收到的心跳数重新恢复到阈值以上
时，该Eureka Server节点就会自动退出自我保护模式。它的设计哲学就是宁可保留错误的服务注册信息，也不盲目注销任何可能
健康的服务实例。-句话讲解:好死不如赖活着.

综上，自我保护模式是一种应对网络异常的安全保护措施。 它的架构哲学是宁可同时保留所有微服务(健康的微服务和不健康的微
服务都会保留)，也不盲目注销任何健康的微服务。使用自我保护模式，可以让Eureka集群更加的健壮、稳定。
在Spring Cloud中,可以使用eureka.server.enable-self-preservation = false禁用自我保护模式。

## 作为服务注册中心，Eureka比Zookeeper好在哪里？

- CAP是什么
    1. C：Consistency（强一致性）
    2. A：Availability（可用性）
    3. P：Partition Tolerance（分区容错性）
    
- 什么是分布式系统的三进二

CAP理论的核心是:一个分布式系统不可能同时很好的满足--致性，可用性和分区容错性这三个需求。（最多只能选两个）
因此，根据CAP原理将NoSQL数据库分成了满足CA原则、满足CP原则和满足AP原则三大类:

1. CA-单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。
2. CP-满足一致性，分区容忍必的系统，通常性能不是特别高。
3. AP-满足可用性，分区容忍性的系统，通常可能对一-致性要求低-些。

- Zookeeper是CP还是AP，Eureka呢？

Zookeeper保证CP（高一致性优先），而Eureka保证AP（高可用优先）

1. Zookeeper保证CP（高一致性优先）

当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息,但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。 
但是zk会出现这样一种情况， 当master节 点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。
问题在于，选举leader的时间太长， 30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。
在云部署的环境下,因网络问题使得zk集群失去master节点是较大概率会发生的事,虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。

Eureka保证AP（高可用优先）

Eureka看明白了这一点,因此在设计时就优先保证可用性。Eureka各 个节点都是平等的，几个节点挂掉不会影响正常节点的工作
，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或时如果发现连接失败,则会自动切换至其
它节点，只要有一台Eureka还在, 就能保证注册服务可用(保证可用性),只不过查到的信息可能不是最新的(不保证强一致性)。 除
此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳,那么Eureka就认为客户端与注册中
心出现了网络故障，此时会出现以下几种情况:
1. Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务
2. Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)
3. 当网络稳定时，当前实例新的注册信息会被同步到其它节点中

因此，Eureka可以很好的应对因网络故障导致部分节点失 去联系的情况，而不会像zookeeper那样使整个注册服务瘫瘓。