#### 以前都是都是用小米手机，最近换了台vivo手机，总感觉少了点东西，心一想，还是少了个悬浮球。市场上一搜，还是没有特别满意的，那就自己动手做吧~

-------
先上2张图，看看成品和原作~上面是原作，下面是我们的成品
![image.png](https://upload-images.jianshu.io/upload_images/1641428-6b8fdf59b2776e77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
![image.png](https://upload-images.jianshu.io/upload_images/1641428-45aea8b6e2fd7a5e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- 效果还是挺像的，为啥这么像？哈哈，因为我是反编译了MIUI悬浮球的Apk，拿了里面的素材，那悬浮球里面的代码是不是可以直接拿来抄呢？很遗憾，混淆了，都是abc~除了一些控件等类没被混淆能看一下，看起来是很吃力了，那干脆自己做把~

#### 观察悬浮球的特点

- 当点击悬浮球时，打开
 1. 以悬浮球为中心，弹开一个半圆的控制面板。5个小圆按钮同时散开来。
 2. 悬浮球从圆变为叉，伴随旋转，同时悬浮球缩小。。

- 再次点击悬浮球，关闭
 1. 悬浮球放大到原始大小，从叉变回圆，还有一定回弹效果。
 2. 5个小圆像悬浮球靠拢，并且慢慢渐变为透明，最后消失。

- 拖动悬浮球
 1. 拖动后松手，悬浮球自动回弹到最左边或者最右边
 2. 松手后一定时间后，悬浮球透明度减少。

- 点击小圆按钮
 1. 菜单图标小圆能调用多任务。
 2. 锁屏图标小圆能调用锁屏。
 3. 截屏按钮能够截屏。
 4. 返回图标小圆能调用返回键。
 5. 桌面图标小圆能调用桌面键。

- 一些细节
 1. 点击悬浮球以外区域收起悬浮球，点击面板区域不会收起。
 2. 面板展开时，不能拖动悬浮球。

#### 实现悬浮球需要的东西

1. 能让View变为悬浮窗。一开始笔者使用Github上的FloatWindow库(https://github.com/yhaolpz/FloatWindow)来快速实现（毕竟重点不是这里），但是有点小坑，里面有些内存泄露导致静态Map无法回收的问题，我看了一遍源码自己手写了一遍，解决掉。
2. 辅助服务，5个小圆按钮的功能。(返回键、桌面键等...)
3. 截屏Api。（安卓5.0开始提供，这里使用官方Api）
4. （最重要）让控制面板从悬浮球中弹出，自定义控件。